{% extends "base.html" %}
{% block title %}{{ faculty.name }} - Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="text-primary fw-bold">
            <i class="bi bi-building me-2"></i> {{ faculty.name }}
        </h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('admin_faculties') }}">Faculties</a></li>
                <li class="breadcrumb-item active">{{ faculty.name }}</li>
            </ol>
        </nav>
    </div>
    <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#addDepartmentModal">
        <i class="bi bi-plus-circle me-2"></i> Add Department
    </button>
</div>

<div class="row g-4">
    {% if faculty.departments %}
        {% for dept in faculty.departments %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 hover-shadow shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-primary fw-bold">{{ dept.name }}</h5>
                    <p class="text-muted mb-2">
                        <i class="bi bi-calendar3 me-1"></i>
                        {{ dept.levels }} year program
                    </p>
                    <p class="text-muted mb-3">
                        <i class="bi bi-book me-1"></i>
                        {{ dept.courses|length }} course{{ 's' if dept.courses|length != 1 else '' }} registered
                    </p>
                    <div class="mt-auto d-grid gap-2">
                        <a href="{{ url_for('admin_department_detail', department_id=dept.id) }}"
                           class="btn btn-outline-primary">
                            <i class="bi bi-arrow-right-circle me-2"></i> View Levels & Courses
                        </a>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-secondary flex-fill" data-bs-toggle="modal" data-bs-target="#editDept{{ dept.id }}">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <form method="POST" action="{{ url_for('delete_department', department_id=dept.id) }}" class="d-inline flex-fill">
                                <button type="submit" class="btn btn-outline-danger w-100"
                                        onclick="return confirm('Delete {{ dept.name }}? All courses will be deleted.')">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <div class="alert alert-info text-center py-5">
                <i class="bi bi-info-circle display-4 mb-3"></i>
                <h4>No departments yet</h4>
                <p class="lead">Add a department to this faculty to continue setup.</p>
            </div>
        </div>
    {% endif %}
</div>

<!-- Add Department Modal -->
<div class="modal fade" id="addDepartmentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('add_department', faculty_id=faculty.id) }}">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Add Department to {{ faculty.name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Department Name</label>
                        <input type="text" name="name" class="form-control form-control-lg" placeholder="e.g. Computer Science" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Number of Levels/Years</label>
                        <select name="levels" class="form-select form-select-lg" required>
                            <option value="4">4 Years</option>
                            <option value="5" selected>5 Years</option>
                            <option value="6">6 Years</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Department</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Department Modals -->
{% for dept in faculty.departments %}
<div class="modal fade" id="editDept{{ dept.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('edit_department', department_id=dept.id) }}">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Department</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Department Name</label>
                        <input type="text" name="name" value="{{ dept.name }}" class="form-control form-control-lg" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Number of Levels/Years</label>
                        <select name="levels" class="form-select form-select-lg" required>
                            {% for i in range(1,7) %}
                            <option value="{{ i }}" {% if i == dept.levels %}selected{% endif %}>{{ i }} Years</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<style>
    .hover-shadow {
        transition: all 0.3s ease;
    }
    .hover-shadow:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
    }
</style>
{% endblock %}